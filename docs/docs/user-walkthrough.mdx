---
title: User walkthrough
---

This tutorial guides you through the complete workflow of creating a data center topology using Infrahub's design-driven automation. You'll create a new branch, load a topology design, run a generator to create infrastructure, review the changes, and merge them to the main branch.

By the end of this walkthrough, you'll understand how to use Infrahub's branch-based workflow to safely design, validate, and deploy network infrastructure.

## Prerequisites

Before starting this tutorial, ensure you have:

- Completed the [installation guide](./install.mdx) and have Infrahub running
- Loaded the bootstrap data and schemas
- Access to the Infrahub web interface at `http://localhost:8000`

## What you'll accomplish

In this tutorial, you will:

1. Create a new branch for your changes
2. Load a data center design (DC-2)
3. Run a generator to create devices, interfaces, and connections
4. Create a proposed change
5. Review the generated artifacts and validation results
6. Merge the changes to the main branch

## Step 1: Create a new branch

All changes in Infrahub happen in branches. This allows you to work on infrastructure changes safely without affecting the main branch until you're ready.

### Using the web interface

1. Navigate to `http://localhost:8000`
2. Click on the branch selector in the top-right corner (shows "main" by default)
3. Click **Create Branch**
4. Enter branch name: `add-dc2`
5. Click **Create**

### Using the CLI

Alternatively, create the branch from the command line:

```bash
uv run infrahubctl branch create add-dc2
```

You should see a success message confirming the branch was created.

:::tip
Branch names should be descriptive and indicate what changes you're making, like `add-dc2`, `update-security-policies`, or `fix-bgp-config`.
:::

## Step 2: Switch to your new branch

In the web interface:

1. Click the branch selector in the top-right
2. Select `add-dc2` from the list
3. The interface should now show `add-dc2` as the active branch

:::info
All subsequent actions will be performed on the `add-dc2` branch until you switch back to another branch.
:::

## Step 3: load the DC-2 design

The DC-2 design is a pre-configured data center topology specification that defines:

- A data center named "DC-2"
- Spine-leaf fabric architecture
- Device roles and platform assignments
- IP address pools and subnets
- BGP autonomous system configuration

Load the design data onto your branch:

```bash
uv run infrahubctl object load data/dc-2.yml --branch add-dc2
```

Watch the output for success messages. You should see confirmations that the topology data has been loaded.

### Verify the design loaded

In the web interface:

1. Ensure you're on the `add-dc2` branch
2. Navigate to **Network Topologies → Deployments → Data center**
3. You should see a new entry for **DC-2**
4. Click on DC-2 to view its properties

The design specifies high-level parameters like:

- Data center name and location
- Number of spines and leaves
- Underlay routing protocol (eBGP or OSPF)
- Addressing schemes

## Step 4: Run the data center generator

Now that the design is loaded, you'll run a generator that transforms the abstract design into concrete infrastructure objects including devices, interfaces, IP addresses, and routing configurations.

### Using the web interface

1. Ensure you're on the `add-dc2` branch
2. Navigate to **Actions → Generator Definitions**
3. Find `create_dc` in the list
4. Click on `create_dc` to open its detail view
5. Click the **Run** button
6. In the dialog, select **Selected Targets**
7. Choose **DC-2** from the dropdown
8. Click **Run Generator**

A task will start. You can monitor its progress in the **Tasks** view.

### Using the CLI

Alternatively, trigger the generator from the command line:

```bash
uv run infrahubctl generator create_dc name=DC-2 --branch add-dc2
```

### Wait for completion

Generator execution can take several minutes as it creates hundreds of objects. Monitor the task status:

1. Navigate to **System → Tasks** in the left sidebar
2. Find your generator task in the list
3. Watch the status change from "Pending" to "Running" to "Completed"

:::tip
Generators create infrastructure following best practices. For DC-2, the create_dc generator will create spine switches, leaf switches, border leafs, management connections, fabric peering, loopback interfaces, and BGP configurations.
:::

## Step 5: Review generated infrastructure

Once the generator completes, explore what was created:

### View devices

1. Navigate to **Device Management → Infrastructure → All Devices**
2. You should see multiple devices created:
   - Spine switches (typically 2 or more)
   - Leaf switches (typically 4 or more)
   - Border leaf switches (typically 2)

### View interfaces

Click on any device to see its details including:

- Physical and loopback interfaces
- IP addresses assigned to each interface
- Interface descriptions and roles

### View IP prefixes

Navigate to **IP Address Management → IP Prefixes** to see:

- Management network prefixes
- Loopback prefixes
- Underlay point-to-point link prefixes

### View routing

Navigate to **Routing** sections to see:

- BGP peer groups
- BGP sessions between spines and leaves
- Autonomous system assignments

## Step 6: Create a proposed change

Now that you've made changes on your branch, create a proposed change to merge them into main. Proposed changes provide a review mechanism with diffs, validation checks, and artifact generation.

### Create the proposed change

1. Navigate to **Proposed Changes**
2. Click **New Proposed Change**
3. Fill in the form:
   - **Name**: `Add DC-2 data center`
   - **Source Branch**: `add-dc2`
   - **Destination Branch**: `main`
   - **Description** (optional): `This change adds the DC-2 data center with spine-leaf fabric`
4. Click **Create Proposed Change**

### Understanding what happens next

When you create a proposed change, Infrahub automatically:

- Creates a diff showing all objects added, modified, or deleted
- Runs validation checks defined in your checks
- Regenerates all artifacts affected by the changes
- Runs repository checks if configured

## Step 7: Review validations and artifacts

Navigate to your proposed change to review the results:

### View the diff

1. Click on the **Files** or **Diff** tab
2. Review all the objects that will be created when you merge
3. You should see hundreds of additions including:
   - Devices
   - Interfaces
   - IP addresses
   - BGP configurations
   - Routing protocols

### Check validation results

1. Click on the **Checks** or **Validations** tab
2. Review the validation results
3. All checks should pass with a green checkmark
4. If any checks fail, review the error messages and fix issues before merging

Common validations include:

- **Spine connectivity checks** - Verify all spines are properly connected
- **Leaf connectivity checks** - Verify all leaves are connected to all spines
- **IP address uniqueness** - Ensure no duplicate IP assignments
- **BGP configuration** - Validate BGP peer groups and sessions

### View generated artifacts

1. Click on the **Artifacts** tab
2. You should see generated artifacts like:
   - Device configurations (one per device)
   - Topology cabling matrix
   - Containerlab topology file (if configured)

Click on any artifact to view its content. For example, view a spine configuration to see the generated CLI commands.

:::tip
Artifacts are regenerated automatically when you create a proposed change. This ensures they always reflect the latest data.
:::

## Step 8: Merge the proposed change

Once you've reviewed everything and all validations pass, you're ready to merge:

1. In the proposed change view, click the **Merge** button
2. Confirm the merge in the dialog
3. Wait for the merge task to complete

The merge process:

- Applies all changes from the source branch to the destination branch
- Runs any post-merge hooks or actions
- Updates the main branch with your new infrastructure

### Verify the merge

1. Switch back to the **main** branch using the branch selector
2. Navigate to **evice Management → Infrastructure → All Devices**
3. You should now see all the DC-2 devices in the main branch
4. Navigate to **Services → Topology Deployments → Data center**
5. Verify that DC-2 appears in the main branch

## Step 9: View device configurations

Now that DC-2 is in the main branch, view the generated device configurations:

1. Ensure you're on the **main** branch
2. Navigate to **Device Management → Infrastructure → All Devices**
3. Click on a spine device (for example, `dc2-spine1`)
4. Look for an **Artifacts** section or tab
5. Click on the spine configuration artifact

You should see a complete device configuration including:

- Interface configurations
- IP addressing
- BGP configuration
- OSPF configuration (if using OSPF underlay)
- VxLAN EVPN configuration

## What you've learned

Congratulations! You've completed the full workflow:

- ✅ Created a branch for your changes
- ✅ Loaded a topology design
- ✅ Ran a generator to create infrastructure
- ✅ Created a proposed change with automatic validation
- ✅ Reviewed diffs, checks, and artifacts
- ✅ Merged changes to the main branch
- ✅ Viewed generated device configurations

## Next steps

Now that you understand the basic workflow, you can:

- **Explore variations** - Try creating DC-3 or a POP topology
- **Modify designs** - Edit the data/dc-2.yml file to change the topology
- **Add network services** - Create Layer 2 or Layer 3 services on top of the fabric
- **Customize configurations** - Modify templates in the `templates/` directory
- **Add validation checks** - Create custom checks in the `checks/` directory

For a deeper understanding, continue to:

- **[Understanding the concepts](./concepts.mdx)** - Learn about design-driven automation and composable topologies
- **[Developer guide](./developer-guide.mdx)** - Understand how generators, transforms, and checks work

## Troubleshooting

### Generator fails or times out

If the generator task fails:

1. Check the task logs in **System → Tasks**
2. Look for error messages indicating what went wrong
3. Common issues include missing data, incorrect schema relationships, or resource allocation failures

### Validation checks fail

If validation checks fail:

1. Review the check output to understand what failed
2. Fix the underlying data issues
3. Re-run validations by updating the proposed change

### Merge conflicts

If you encounter merge conflicts:

1. Review the conflicting objects
2. Resolve conflicts manually if needed
3. You may need to rebase your branch or create a new branch

## Using the CLI for the workflow

You can also perform this entire workflow from the command line. Here's the abbreviated version:

```bash
# Create branch
uv run infrahubctl branch create add-dc2

# Load design
uv run infrahubctl object load data/dc-2.yml --branch add-dc2

# Run generator (requires API calls - easier via web interface)
# Create proposed change (easier via web interface)

# After merge, verify on main
uv run infrahubctl branch list
```

For complex workflows involving generators and proposed changes, the web interface provides a better experience with visual feedback and monitoring.
