# yaml-language-server: $schema=https://schema.infrahub.app/infrahub/schema/latest.json
---
version: "1.0"

nodes:
  - name: VirtualFabric
    namespace: Service
    description: "Service for deploying customer services with automated resource allocation based on customer size"
    label: "Deploy Customer"
    icon: "mdi:account-plus"
    include_in_menu: true
    menu_placement: "ServiceGeneric"
    default_filter: name__value
    uniqueness_constraints:
      - [name__value]
    human_friendly_id:
      - name__value
    display_labels:
      - name__value
    order_by: [name__value]
    attributes:
      - name: name
        kind: Text
        computed_attribute:
          kind: Jinja2
          jinja2_template: "{{deployment__name__value}} - {{ customer__name__value }}"
        read_only: true
        optional: false
        description: "Unique name for the customer deployment"
      - name: deployment_size
        kind: Dropdown
        description: "Customer size tier determining resource allocation"
        order_weight: 1300
        optional: false
        choices:
          - name: s
            label: Small (S)
            description: "Small customer - 10 Segments, 20 prefixes"
            color: "#90EE90"
          - name: m
            label: Medium (M)
            description: "Medium customer - 50 Segments, 100 prefixes"
            color: "#87CEEB"
          - name: l
            label: Large (L)
            description: "Large customer - 100 Segments, 500 prefixes"
            color: "#DDA0DD"
          - name: x
            label: Extra Large (X)
            description: "Enterprise customer - 200 Segments, 2000 prefixes"
            color: "#F0E68C"
        default_value: m
      - name: status
        kind: Dropdown
        description: "Deployment status"
        order_weight: 1400
        optional: false
        choices:
          - name: planning
            label: Planning
            description: "Deployment is being planned"
            color: "#FFE4B5"
          - name: provisioning
            label: Provisioning
            description: "Resources are being provisioned"
            color: "#FFFF7F"
          - name: active
            label: Active
            description: "Customer is fully deployed and active"
            color: "#7FBF7F"
          - name: maintenance
            label: Maintenance
            description: "Customer deployment is under maintenance"
            color: "#FFD27F"
          - name: decommissioning
            label: Decommissioning
            description: "Customer deployment is being decommissioned"
            color: "#FBFBFB"
          - name: decommissioned
            label: Decommissioned
            description: "Customer deployment has been decommissioned"
            color: "#BFBFBF"
        default_value: planning
    relationships:
      - name: customer
        peer: OrganizationCustomer
        cardinality: one
        kind: Attribute
        order_weight: 1100
        optional: false
        description: "The customer organization being deployed"
      - name: deployment
        peer: TopologyDataCenter
        cardinality: one
        kind: Attribute
        order_weight: 1000
        optional: false
        description: "The deployment location for customer services"

extensions:
  nodes:
    - kind: OrganizationCustomer
      relationships:
        - name: customer_deployments
          peer: ServiceVirtualFabric
          cardinality: many
          kind: Component
          optional: true
          order_weight: 2500
          description: "Customer deployment instances"
    - kind: TopologyDataCenter
      relationships:
        - name: customer_deployments
          peer: ServiceVirtualFabric
          cardinality: many
          kind: Component
          optional: true
          order_weight: 2600
          description: "Customer deployments in this location"