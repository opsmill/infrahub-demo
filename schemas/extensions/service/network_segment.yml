# yaml-language-server: $schema=https://schema.infrahub.app/infrahub/schema/latest.json
---
version: "1.0"

nodes:
  - name: NetworkSegment
    namespace: Service
    description: "Network segment that can span multiple devices using VXLAN/EVPN"
    label: Network Segment
    icon: "carbon:network-3"
    menu_placement: ServiceDeviceGeneric
    include_in_menu: true
    inherit_from:
      - ServiceDeviceGeneric
    attributes:
      - name: vni
        kind: Number
        label: VNI
        optional: false
        order_weight: 2
      - name: segment_type
        kind: Dropdown
        description: "Type of network segment"
        choices:
          - name: l2_only
            label: L2 Only
            description: "Layer 2 segment only"
            color: "#A9CCE3"
          - name: l3_gateway
            label: L3 Gateway
            description: "Layer 2 segment with L3 gateway"
            color: "#A9DFBF"
          - name: l3_vrf
            label: L3 VRF
            description: "Layer 3 VRF segment"
            color: "#D2B4DE"
        default_value: "l2_only"
        order_weight: 1600
      - name: tenant_isolation
        kind: Dropdown
        description: "Level of tenant isolation for this segment"
        choices:
          - name: customer_dedicated
            label: Customer Dedicated
            description: "Dedicated to a single customer"
            color: "#E74C3C"
          - name: shared_controlled
            label: Shared Controlled
            description: "Shared between selected customers"
            color: "#F39C12"
          - name: public_shared
            label: Public Shared
            description: "Public shared segment"
            color: "#3498DB"
        default_value: "customer_dedicated"
        order_weight: 1650
    relationships:
      - name: customer
        peer: OrganizationCustomer
        label: Customer
        cardinality: one
        kind: Attribute
        optional: true
        description: "Customer this segment is dedicated to (if tenant_isolation is customer_dedicated)"
        order_weight: 1700
      - name: namespace
        peer: IpamNamespace
        label: IPAM Namespace
        cardinality: one
        kind: Attribute
        optional: false
        description: "IPAM namespace for tenant isolation"
        order_weight: 1750
      # - name: vxlan_services
      #   peer: ServiceVXLAN
      #   label: VXLAN Services
      #   cardinality: many
      #   kind: Attribute
      #   optional: true
      #   order_weight: 1800
      #   description: "VXLAN services implementing this segment"
      - name: member_interfaces
        peer: DcimInterface
        label: Member Interfaces
        cardinality: many
        kind: Component
        optional: true
        order_weight: 1900
        description: "Interfaces that are members of this network segment"
      - name: ip_prefixes
        peer: IpamPrefix
        label: IP Prefixes
        cardinality: many
        kind: Component
        optional: true
        identifier: "network_segment__ip_prefixes"
        order_weight: 2000
        description: "IP prefixes allocated within this segment's namespace"
