# yaml-language-server: $schema=https://schema.infrahub.app/infrahub/schema/latest.json
---
version: "1.0"

nodes:
  - name: NetworkSegment
    namespace: Service
    description: "Network segment with automated VLAN, VNI, and RD assignment"
    label: Network Segment
    icon: "carbon:network-3"
    menu_placement: ServiceDeviceGeneric
    uniqueness_constraints:
      - [deployment, owner, environment__value, customer_name__value]
    include_in_menu: true
    inherit_from:
      - ServiceGeneric
      - ServiceGenericInterfaces
    attributes:
      - name: name
        kind: Text
        computed_attribute:
          kind: Jinja2
          jinja2_template: >-
            {{deployment__name__value}} - {{ owner__name__value }} -
            {{ environment__value }} - {{ customer_name__value }}
        read_only: true
        optional: false
      - name: customer_name
        kind: Text
        label: Customer Segment Name
        optional: false
        order_weight: 1
      - name: environment
        kind: Dropdown
        description: "Customer Environment"
        choices:
          - name: production
            label: Production
            description: "Production environment"
            color: "#A9CCE3"
          - name: no-production
            label: No Production
            description: "Non-Production environment"
            color: "#A9DFBF"
        default_value: production
        order_weight: 2
      - name: segment_type
        kind: Dropdown
        description: "Type of network segment"
        choices:
          - name: l2_only
            label: L2 Only
            description: "Layer 2 segment only"
            color: "#A9CCE3"
          - name: l3_gateway
            label: L3 Gateway
            description: "Layer 2 segment with L3 gateway"
            color: "#A9DFBF"
          - name: l3_vrf
            label: L3 VRF
            description: "Layer 3 VRF segment"
            color: "#D2B4DE"
        default_value: "l2_only"
        order_weight: 3
      - name: tenant_isolation
        kind: Dropdown
        description: "Level of tenant isolation for this segment"
        choices:
          - name: customer_dedicated
            label: Customer Dedicated
            description: "Dedicated to a single customer"
            color: "#E74C3C"
          - name: shared_controlled
            label: Shared Controlled
            description: "Shared between selected customers"
            color: "#F39C12"
          - name: public_shared
            label: Public Shared
            description: "Public shared segment"
            color: "#3498DB"
        default_value: "customer_dedicated"
        order_weight: 4
      - name: vlan_id
        kind: Number
        label: VLAN ID
        optional: false
        order_weight: 5
        description: "VLAN ID assigned from customer pool (VNI = VLAN + 10000, RD = VLAN)"
      - name: external_routing
        kind: Boolean
        label: External Routing
        optional: true
        default_value: false
        order_weight: 1550
        description: "Enable routing outside the namespace"
    relationships:
      - name: deployment
        peer: TopologyDeployment
        cardinality: one
        kind: Attribute
        order_weight: 1000
        optional: false
        on_delete: no-action
        description: "The deployment location for customer services"
      - name: prefix
        peer: IpamPrefix
        label: Prefix
        cardinality: one
        kind: Generic
        optional: true
